<!-- mesero_vista_cocina.html -->
<style>
    .vista-cocina-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 1.5rem;
    }
    .columna-cocina h3 {
        border-bottom: 2px solid var(--gris-piedra);
        padding-bottom: 0.5rem;
        margin-bottom: 1rem;
        color: var(--carbon-suave);
    }
    .orden-card-cocina {
        background: #fff;
        border: 1px solid var(--gris-piedra);
        border-radius: 8px;
        margin-bottom: 1rem;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    .orden-header-cocina {
        background-color: var(--carbon-suave);
        color: white;
        padding: 0.75rem 1rem;
        border-radius: 8px 8px 0 0;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .orden-card-cocina.lista .orden-header-cocina {
        background: linear-gradient(135deg, #28a745, #20c997);
    }
    .lista-productos-cocina {
        list-style: none;
        padding: 0.5rem 1rem 1rem 1rem;
        margin: 0;
    }
    .producto-item-cocina {
        padding: 0.5rem 0;
        border-bottom: 1px solid #eee;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .producto-item-cocina:last-child {
        border-bottom: none;
    }
    .producto-item-cocina .estado-listo {
        color: var(--verde-listo);
        font-weight: 600;
    }
    .producto-item-cocina .estado-pendiente {
        color: var(--naranja-tostado);
        font-weight: 600;
    }
</style>

<div id="vista-cocina-container">
    <div class="vista-cocina-grid">
        <div id="cocina-pendientes" class="columna-cocina">
            <h3>üç≥ En Preparaci√≥n</h3>
            <div class="loading">Cargando...</div>
        </div>
        <div id="cocina-listas" class="columna-cocina">
            <h3>üçΩÔ∏è Listo para Servir</h3>
            <div class="loading">Cargando...</div>
        </div>
    </div>
</div>

<template id="cocina-card-template">
    <div class="orden-card-cocina">
        <div class="orden-header-cocina">
            <span class="mesa-cocina font-bold">Mesa #</span>
            <span class="hora-cocina text-sm"></span>
        </div>
        <ul class="lista-productos-cocina"></ul>
    </div>
</template>

<script>
    function inicializar_vista_cocina() {
        const pendientesContainer = document.getElementById('cocina-pendientes');
        const listasContainer = document.getElementById('cocina-listas');
        const template = document.getElementById('cocina-card-template');

        const renderizarVistaCocina = (ordenes) => {
            pendientesContainer.innerHTML = '<h3>üç≥ En Preparaci√≥n</h3>';
            listasContainer.innerHTML = '<h3>üçΩÔ∏è Listo para Servir</h3>';

            let hayPendientes = false;
            let hayListas = false;

            if (!ordenes || ordenes.length === 0) {
                pendientesContainer.innerHTML += '<p>No hay √≥rdenes en preparaci√≥n.</p>';
                listasContainer.innerHTML += '<p>No hay √≥rdenes listas.</p>';
                return;
            }

            ordenes.forEach(orden => {
                const cardNode = document.importNode(template.content, true);
                const card = cardNode.querySelector('.orden-card-cocina');
                
                card.querySelector('.mesa-cocina').textContent = `Mesa #${orden.mesa}`;
                card.querySelector('.hora-cocina').textContent = orden.creado_en;
                
                const productosList = card.querySelector('.lista-productos-cocina');
                productosList.innerHTML = ''; // Limpiar lista

                orden.productos.forEach(p => {
                    const li = document.createElement('li');
                    li.className = 'producto-item-cocina';
                    const estadoHTML = p.estado === 'LISTO' 
                        ? `<span class="estado-listo">‚úî Listo</span>`
                        : `<span class="estado-pendiente">Cocinando...</span>`;
                    
                    li.innerHTML = `<span>${p.cantidad}x ${p.nombre}</span> ${estadoHTML}`;
                    productosList.appendChild(li);
                });

                if (orden.completada) {
                    card.classList.add('lista');
                    listasContainer.appendChild(card);
                    hayListas = true;
                } else {
                    pendientesContainer.appendChild(card);
                    hayPendientes = true;
                }
            });

            if (!hayPendientes) pendientesContainer.innerHTML += '<p>No hay √≥rdenes en preparaci√≥n.</p>';
            if (!hayListas) listasContainer.innerHTML += '<p>No hay √≥rdenes listas.</p>';
        };

        window.actualizar_vista_cocina = async () => {
            try {
                const response = await fetch("{% url 'api_get_ordenes_cocina' %}");
                if (!response.ok) throw new Error('Error de red');
                const data = await response.json();
                renderizarVistaCocina(data);
            } catch (error) {
                console.error("Error al actualizar vista de cocina:", error);
                pendientesContainer.innerHTML = '<p class="error-message">No se pudo cargar la vista de cocina.</p>';
                listasContainer.innerHTML = '';
            }
        };

        // Carga inicial
        window.actualizar_vista_cocina();
    }
    
    // Ejecutar la inicializaci√≥n si la funci√≥n no existe ya (para evitar re-ejecuci√≥n)
    if (typeof inicializar_vista_cocina === 'function') {
        inicializar_vista_cocina();
    }
</script>
